---
- name: install docker prerequisites
  yum:
    state: present
    update_cache: yes
    name: ['yum-utils', 'device-mapper-persistent-data', 'lvm2']
- name: add docker repo
  yum_repository:
    name: centos-extras
    description: centos-extras
    baseurl: "http://mirror.centos.org/centos/7/extras/x86_64"
    gpgcheck: yes
    gpgkey: "file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7"

- name: add docker repo
  yum_repository:
    name: docker-ce-stable
    description: docker-ce-stable
    baseurl: "https://download.docker.com/linux/centos/7/$basearch/stable"
    gpgcheck: yes
    gpgkey: "https://download.docker.com/linux/centos/gpg"

- name: install docker-ce
  yum:
    name: ['docker-ce', 'docker-ce-cli', 'containerd.io']
    update_cache: yes
    state: present
- group:
    name: docker 
    state: present
- user:
    name: "{{ loginName }}"
    append: yes
    groups: docker    
- name: ensure base services are started
  service:
    name: docker
    state: started
    enabled: yes
